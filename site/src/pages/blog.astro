---
import BaseLayout from "../layouts/BaseLayout.astro";
import NewsletterEmbed from "../components/NewsletterEmbed.astro";

const title = "Remote Work Blog";
const description = "practical guides, tips, and insights for building your remote work career";

// Load every post file living in /src/pages/blog/*.astro
// This page itself is /src/pages/blog.astro, so './blog/*.astro' is the right glob.
const all = await Astro.glob('./blog/*.astro');

// Exclude an index file if you keep one inside /blog (optional)
const posts = all
  .filter(p => !/\/index\.astro$/.test(p.file))
  // newest first by exported `date` (falls back to 0 if missing)
  .sort((a, b) => {
    const da = new Date(a?.frontmatter?.date ?? a?.date ?? 0).getTime() || 0;
    const db = new Date(b?.frontmatter?.date ?? b?.date ?? 0).getTime() || 0;
    return db - da;
  });

function niceDate(d) {
  const t = new Date(d);
  return isNaN(t.getTime()) ? "" : t.toLocaleDateString();
}
function titleOf(p) {
  return p?.frontmatter?.title ?? p?.title ?? (p.url?.split('/').pop()?.replace(/-/g, ' ') ?? 'untitled');
}
function excerptOf(p) {
  return p?.frontmatter?.excerpt ?? p?.excerpt ?? "";
}
function tagsOf(p) {
  return p?.frontmatter?.tags ?? p?.tags ?? [];
}
---
<BaseLayout {title} {description}>
  <section class="hero">
    <h1>remote work insights</h1>
    <p class="lead">practical guides, tips, and strategies to help you succeed in the remote work world</p>
  </section>

  {posts.length > 0 && (
    <section class="featured-article card highlight">
      <div class="featured-content">
        <span class="pill accent">featured</span>
        <h2><a href={posts[0].url}>{titleOf(posts[0])}</a></h2>
        <p class="article-excerpt">{excerptOf(posts[0])}</p>
        <div class="article-meta">
          <span class="muted">{niceDate(posts[0].frontmatter?.date || posts[0].date)}</span>
          <div class="article-tags">
            {tagsOf(posts[0]).map(t => <span class="pill">{t}</span>)}
          </div>
        </div>
      </div>
    </section>
  )}

  <section class="articles-grid">
    {posts.slice(1).map(p => (
      <article class="article-card card">
        <h3><a href={p.url}>{titleOf(p)}</a></h3>
        <p class="article-excerpt">{excerptOf(p)}</p>
        <div class="article-meta">
          <span class="muted">{niceDate(p.frontmatter?.date || p.date)}</span>
          <div class="article-tags">
            {tagsOf(p).map(t => <span class="pill">{t}</span>)}
          </div>
        </div>
        <p style="margin-top:8px;">
          <a class="btn btn--outline" href={p.url}>Read More â†’</a>
        </p>
      </article>
    ))}
  </section>

  <section class="newsletter-cta card cta">
    <NewsletterEmbed
      title="stay updated on remote work trends"
      sub="get weekly insights, job alerts, and remote work tips delivered to your inbox"
    />
  </section>

  <style>
    .featured-content { position: relative; }
    .featured-content h2 { font-size: var(--font-size-2xl); margin: var(--space-3) 0 var(--space-2) 0; }
    .featured-content h2 a,
    .article-card h3 a { color: var(--color-black); text-decoration: none; }
    .featured-content h2 a:hover,
    .article-card h3 a:hover { color: var(--color-secondary); }
    .article-excerpt { font-size: var(--font-size-base); color: var(--color-gray-600); margin-bottom: var(--space-4); line-height: 1.6; }

    .articles-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: var(--space-6);
      margin-bottom: var(--space-8);
    }
    .article-card h3 { font-size: var(--font-size-lg); margin-bottom: var(--space-2); }
    .article-card .article-excerpt { font-size: var(--font-size-sm); margin-bottom: var(--space-3); }
    .article-meta { display: flex; flex-direction: column; gap: var(--space-2); }
    .article-tags { display: flex; flex-wrap: wrap; gap: var(--space-1); }

    @media (max-width: 768px) {
      .articles-grid { grid-template-columns: 1fr; gap: var(--space-4); }
    }
  </style>
</BaseLayout>
